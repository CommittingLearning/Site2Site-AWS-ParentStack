AWSTemplateFormatVersion: "2010-09-09"
Description: "Parent stack for deploying VPC, EC2, and VPN Gateway"

Parameters:
  Environment:
    Type: String
    Description: The environment name (e.g., development, production)
    AllowedValues:
      - development
      - production
      - default

  VPCStackURL:
    Type: String
    Description: The URL for the VPC Template

  EC2StackURL:
    Type: String
    Description: "The URL for the EC2 Template"

  VGWStackURL:
    Type: String
    Description: "The URL for the VPN Gateway Template"

Resources:
  VPCStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref VPCStackURL
      Parameters:
        Environment: !Ref Environment
      TimeoutInMinutes: 10

  EC2Stack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref EC2StackURL
      Parameters:
        VPCId: !GetAtt VPCStack.Outputs.VPCId
        SubnetId: !GetAtt VPCStack.Outputs.SubnetId
        SecurityGroupId: !GetAtt VPCStack.Outputs.SecurityGroupId
        Environment: !Ref Environment
      TimeoutInMinutes: 10

  VGWStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref VGWStackURL
      Parameters:
        VPCId: !GetAtt VPCStack.Outputs.VPCId
        SubnetId: !GetAtt VPCStack.Outputs.SubnetId
        Environment: !Ref Environment
      TimeoutInMinutes: 10

  